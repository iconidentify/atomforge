# AtomForge

A professional FDO compilation toolkit that converts text-based FDO definitions into optimized binary formats using the Ada32.dll compilation engine. Available as both a command-line interface and HTTP REST API.

## Overview

AtomForge provides a complete toolchain for FDO (Form Definition Object) compilation, utilizing the authentic Ada32.dll library through Wine containerization. The system transforms textual FDO source code into binary stream formats with cross-platform compatibility.

## Features

- **Command Line Interface** - Direct compilation via Python harness
- **HTTP REST API** - Web service with JSON interface and browser UI
- **Docker Containerization** - Isolated Wine environment with Ada32.dll
- **Cross-Platform Support** - Works on macOS (ARM64), Linux, and Windows
- **Authentic Compilation** - Uses original Ada32.dll for binary output compatibility

## Quick Start

### Prerequisites

- Docker and Docker Compose
- Git
- Python 3.8+ (for CLI usage)

### Command Line Usage

```bash
# Clone the repository
git clone <repository-url>
cd ada32_toolkit

# Compile FDO file
python fdo_compile.py input.txt [output.fdo]
```

The CLI tool automatically:
- Builds Docker container if needed
- Escapes special characters (& becomes 26x)
- Runs Ada32.dll compilation
- Outputs compiled binary file

### API/Web Interface Usage

```bash
# Navigate to API directory
cd api

# Create Python virtual environment
python3 -m venv venv
source venv/bin/activate

# Install dependencies
pip install fastapi uvicorn

# Start the server
python -m src.api_server
```

The web interface will be available at:
- **Main Interface**: http://localhost:8000
- **API Documentation**: http://localhost:8000/api
- **Health Check**: http://localhost:8000/health

### API Integration

```bash
# Compile via HTTP POST
curl -X POST http://localhost:8000/compile \
  -H "Content-Type: application/json" \
  -d '{"source": "uni_start_stream <00x>\n  man_start_object <independent, \"Test\">\n  man_end_object <>\nuni_end_stream <>"}' \
  --output compiled.fdo

# Check service health
curl http://localhost:8000/health
```

## Architecture

### Core Components

- **Ada32.dll** - Original FDO compilation library (239KB)
- **atomforge.exe** - C-based compilation executable
- **Wine Environment** - Windows emulation for cross-platform compatibility
- **Docker Container** - Isolated compilation environment
- **Python Harness** - CLI and API interface layer

### Directory Structure

```
ada32_toolkit/
├── api/                        # HTTP REST API service
│   ├── src/
│   │   ├── api_server.py       # FastAPI server
│   │   └── fdo_compiler.py     # Compiler interface module
│   ├── static/                 # Web interface assets
│   │   ├── index.html          # Main web UI
│   │   ├── script.js           # Frontend JavaScript
│   │   └── style.css           # UI styling
│   └── requirements.txt        # Python dependencies
├── bin/                        # Executables and libraries
│   ├── atomforge.exe           # Main compiler executable
│   └── dlls/
│       ├── Ada32.dll           # Core compilation library
│       ├── Ada.bin             # Token definitions
│       └── GIDINFO.INF         # Configuration
├── build_tools/                # Docker build configuration
│   ├── Dockerfile              # Container definition
│   └── docker-compose.yml      # Service orchestration
├── golden_tests_immutable/     # Reference test data
├── src/                        # Source code
│   └── atomforge.c             # Main compiler source
└── fdo_compile.py              # CLI Python harness
```

## File Formats

### Input: FDO Source (.txt)
```
uni_start_stream <00x>
  man_start_object <independent, "Test Room">
    mat_object_id <test-001>
    mat_orientation <vcf>
    mat_position <center_center>
  man_end_object <>
uni_end_stream <>
```

### Output: Binary Stream (.fdo)
Compiled binary format generated by Ada32.dll, typically containing optimized form definitions for runtime execution.

## Docker Manual Usage

For advanced usage or debugging:

```bash
# Build and run container manually
cd build_tools
docker-compose run --rm ada32-wine bash

# Inside container
cd /ada32_toolkit
wine bin/atomforge.exe input.txt output.fdo
```

## Development

### Building from Source

The Docker container automatically builds the Wine environment and configures Ada32.dll. No manual compilation steps are required for the Ada32.dll integration.

### Testing

Use the reference data in `golden_tests_immutable/` directory to validate compilation output against known-good binary files.

### API Development

The API server supports development mode with auto-reload:

```bash
cd api
source venv/bin/activate
ENV=development PORT=8001 python -m src.api_server
```

## Configuration

### Environment Variables

- `PORT` - API server port (default: 8000)
- `HOST` - API server host (default: 0.0.0.0)
- `ENV` - Environment mode (development/production)

### Docker Configuration

The system uses a Linux AMD64 container with Wine for Ada32.dll compatibility. Platform specification in docker-compose.yml ensures consistent behavior across ARM64 and x86_64 hosts.

## Troubleshooting

### Common Issues

1. **Docker Build Failures** - Ensure Docker has sufficient memory (4GB+ recommended)
2. **Wine Issues** - Container automatically initializes Wine environment
3. **Permission Errors** - Ensure proper file permissions for input/output directories
4. **Port Conflicts** - Change PORT environment variable if 8000 is in use

### Compilation Errors

- Verify FDO syntax matches expected format
- Check for special characters that need escaping
- Ensure input files are UTF-8 encoded

## License

This project utilizes the Ada32.dll library for FDO compilation. Ensure compliance with applicable licenses for commercial use.