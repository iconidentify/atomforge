<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AtomForge - FDO Compiler & Decompiler</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236366f1'><path d='M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5'/></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <!-- Minimal App Shell -->
    <header class="topbar">
        <div class="brand">AtomForge</div>
        <nav class="mode-tabs" role="tablist" aria-label="Modes">
            <button role="tab" id="tab-compile" class="tab" data-mode="compile" aria-selected="true" aria-controls="panel-compile">Compile</button>
            <button role="tab" id="tab-decompile" class="tab" data-mode="decompile" aria-selected="false" aria-controls="panel-decompile" tabindex="-1">Decompile</button>
        </nav>
        <div class="actions">
            <div class="examples">
                <button id="examplesBtn" class="btn ghost" aria-haspopup="menu" aria-expanded="false">Examples</button>
                <menu id="examplesMenu" class="menu" role="menu" hidden>
                    <!-- populated by JS: <button role="menuitem" data-example="basic">Basic Object</button> -->
                </menu>
            </div>
            <button id="apiBtn" class="btn ghost">API</button>
            <button id="runBtn" class="btn primary"><span class="label">Run</span></button>
        </div>
    </header>

    <main class="content">
        <!-- Panels -->
        <section id="panel-compile" class="panel" role="tabpanel" aria-labelledby="tab-compile">
            <textarea id="fdoInput" class="editor" spellcheck="false" placeholder="Enter FDO source…"></textarea>
        </section>

        <section id="panel-decompile" class="panel" role="tabpanel" aria-labelledby="tab-decompile" hidden>
            <div class="decompile-inputs">
                <div class="toggle">
                    <div class="toggle-buttons">
                        <button class="toggle-btn active" data-input="hex">Hex</button>
                        <button class="toggle-btn" data-input="file">File</button>
                    </div>
                    <div class="decompile-options">
                        <label class="checkbox-label">
                            <input type="checkbox" id="preNormalizeCheck" class="checkbox">
                            <span class="checkbox-text">Pre-normalize input</span>
                        </label>
                    </div>
                    <button id="extractFdoBtn" class="btn small" hidden>Extract FDO</button>
                </div>

                <div id="fileInputView" class="input-view" hidden>
                    <div class="drop" id="binaryDrop">
                        <span>Drop an FDO binary or JSONL file here or click to choose</span>
                    </div>
                    <input id="binaryFile" type="file" accept=".fdo,.str,.bin,.jsonl" hidden />
                    <div class="file-meta">
                        <span>Decoded: <span id="fileDecoded">0</span> bytes</span>
                        <button id="openAsHexBtn" class="btn small" hidden>Open as Hex</button>
                        <div id="jsonlSpinner" class="spinner" hidden>
                            <div class="spinner-icon"></div>
                            <span class="spinner-text">Processing JSONL...</span>
                        </div>
                    </div>
                </div>

                <div id="hexInputView" class="input-view active">
                    <textarea id="hexInput" class="editor mono" spellcheck="false" placeholder="Paste hex here (e.g., 40 01 02 … or 400102…)"></textarea>
                    <div class="file-meta">
                        <span>Decoded: <span id="hexDecoded">0</span> bytes</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Content Splitter -->
        <div class="splitter h content-split" role="separator" aria-orientation="horizontal" tabindex="0" aria-label="Resize output"></div>

        <!-- Output -->
        <section class="output">
            <div class="output-tabs" role="tablist" aria-label="Output">
                <button class="tab small" data-tab="status" aria-selected="true">Status</button>
                <button class="tab small" data-tab="hex">Hex</button>
                <button class="tab small" data-tab="source">Source</button>
            </div>
            <div class="output-panels">
                <div id="out-status" class="out-panel" role="tabpanel">
                    <div id="statusLog" class="log">
                    </div>
                </div>
                <div id="out-hex" class="out-panel" role="tabpanel" hidden>
                    <div class="out-toolbar">
                        <div class="left">Binary Output (<span id="compileSize">0 bytes</span>)</div>
                        <div class="right">
                            <button id="downloadBin" class="btn small">Download</button>
                            <button id="copyHex" class="btn small">Copy Hex</button>
                        </div>
                    </div>
                    <pre id="hexView" class="viewer mono"></pre>
                </div>
                <div id="out-source" class="out-panel" role="tabpanel" hidden>
                    <div class="out-toolbar">
                        <div class="left">Source Output (<span id="decompileSize">0 chars</span>)</div>
                        <div class="right">
                            <button id="downloadTxt" class="btn small">Download</button>
                            <button id="copySource" class="btn small">Copy All</button>
                        </div>
                    </div>
                    <pre id="sourceView" class="viewer mono"></pre>
                </div>
            </div>
        </section>
    </main>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container" aria-live="polite" aria-label="Notifications"></div>

    <!-- API Documentation Modal -->
    <div id="apiModal" class="modal" hidden role="dialog" aria-labelledby="apiModalTitle" aria-modal="true">
        <div class="modal-backdrop" aria-hidden="true"></div>
        <div class="modal-content">
            <header class="modal-header">
                <h2 id="apiModalTitle">AtomForge API Documentation</h2>
                <button id="apiModalClose" class="btn ghost small" aria-label="Close API documentation">×</button>
            </header>
            <div class="modal-body">
                <section class="api-overview">
                    <p>The AtomForge API provides programmatic access to FDO compilation, decompilation, and P3 packet processing capabilities.</p>
                    <p><strong>Base URL:</strong> <code class="api-base-url">http://localhost:8000</code></p>
                </section>

                <section class="api-endpoint">
                    <h3>Compile FDO Source</h3>
                    <div class="endpoint-meta">
                        <span class="method post">POST</span>
                        <code>/compile</code>
                    </div>
                    <p>Compiles FDO source code into binary format.</p>

                    <h4>Request Body</h4>
                    <pre class="code-block"><code>{
  "source": "uni_start_stream &lt;00x&gt;\n  man_start_object &lt;independent, \"Example\"&gt;\n    mat_object_id &lt;example-001&gt;\n  man_end_object &lt;&gt;\nuni_end_stream &lt;&gt;"
}</code></pre>

                    <h4>cURL Example</h4>
                    <div class="code-example">
                        <pre class="code-block"><code>curl -X POST http://localhost:8000/compile \
  -H "Content-Type: application/json" \
  -d '{
    "source": "uni_start_stream <00x>\n  man_start_object <independent, \"Example\">\n    mat_object_id <example-001>\n  man_end_object <>\nuni_end_stream <>"
  }' \
  --output compiled.fdo</code></pre>
                        <button class="copy-btn" data-copy="compile">Copy</button>
                    </div>

                    <h4>Response</h4>
                    <p>Returns binary FDO data (application/octet-stream) on success, or JSON error on failure.</p>
                </section>

                <section class="api-endpoint">
                    <h3>Decompile FDO Binary</h3>
                    <div class="endpoint-meta">
                        <span class="method post">POST</span>
                        <code>/decompile</code>
                    </div>
                    <p>Decompiles FDO binary data back to source code.</p>

                    <h4>Request Body</h4>
                    <pre class="code-block"><code>{
  "binary_data": "base64-encoded-fdo-binary",
  "pre_normalize": false
}</code></pre>

                    <h4>cURL Example</h4>
                    <div class="code-example">
                        <pre class="code-block"><code>curl -X POST http://localhost:8000/decompile \
  -H "Content-Type: application/json" \
  -d '{
    "binary_data": "'$(base64 -i compiled.fdo)'",
    "pre_normalize": false
  }'</code></pre>
                        <button class="copy-btn" data-copy="decompile">Copy</button>
                    </div>

                    <h4>Response</h4>
                    <pre class="code-block"><code>{
  "success": true,
  "source_code": "uni_start_stream <00x>\n...",
  "output_size": 156,
  "input_size": 42
}</code></pre>
                </section>

                <section class="api-endpoint">
                    <h3>Extract FDO from P3 Packets</h3>
                    <div class="endpoint-meta">
                        <span class="method post">POST</span>
                        <code>/extract-fdo</code>
                    </div>
                    <p>Extracts FDO data from P3 packet streams for further processing.</p>

                    <h4>Request Body</h4>
                    <pre class="code-block"><code>{
  "hex_data": "504b030414001400010008004a4d..."
}</code></pre>

                    <h4>cURL Example</h4>
                    <div class="code-example">
                        <pre class="code-block"><code>curl -X POST http://localhost:8000/extract-fdo \
  -H "Content-Type: application/json" \
  -d '{
    "hex_data": "504b030414001400010008004a4d..."
  }'</code></pre>
                        <button class="copy-btn" data-copy="extract">Copy</button>
                    </div>

                    <h4>Response</h4>
                    <pre class="code-block"><code>{
  "success": true,
  "fdo_hex": "40010208001c...",
  "frames_found": 3,
  "total_fdo_bytes": 156,
  "input_size": 1024
}</code></pre>
                </section>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/static/script.js"></script>
</body>
</html>